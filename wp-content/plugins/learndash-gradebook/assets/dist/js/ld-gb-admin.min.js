var LD_GB_Main,LD_GB_jQuery_Repeaters;!function(s){function e(){var t=s(this).closest(".postbox"),o=t.find(".ld-gb-widget-users"),a=o.find(".ld-gb-widget-user-template"),n=t.find('[name="ld_gb_widget_gradebook"]'),e=n.length&&n.find("option:selected").val()||0,i=t.find('[name="ld_gb_widget_group"]'),d=i.length&&i.find("option:selected").val()||0,r=s('<div class="ld-gb-widget-users-overlay"><span class="spinner"></span></div>');t.find(".ld-gb-widget-users-container").append(r),s.post(ajaxurl,{action:"ld_gb_dashboard_widget_get_data",group_id:d,gradebook_id:e,user_id:LD_GB_Admin.current_user_id},function(e){n.length&&t.find(".ld-gb-widget-gradebook-name").html(n.find("option:selected").html().trim()),o.find("tr:not(.ld-gb-widget-user-template)").remove(),e.data.users?s.each(e.data.users,function(e,t){var n=a.clone();n.find(".ld-gb-widget-user-name").html(t.name),n.find(".ld-gb-widget-user-grade").html(t.grade),n.removeClass("ld-gb-widget-user-template"),n.show(),o.append(n)}):o.append("<tr><td>"+LD_GB_Admin.l10n.no_users+"</td></tr>"),r.remove()})}s(function(){s(document).on("change",'[name="ld_gb_widget_gradebook"], [name="ld_gb_widget_group"]',e)})}(jQuery),function(e){var t=LD_GB_Main={init:function(){e("#ld-gb-gradebook-selector, #ld-gb-group-selector").change(t.gradebook_form_submit)},gradebook_form_submit:function(){e(this).closest("form").submit()}};e(t.init)}(jQuery,LD_GB_Admin.l10n),function(i,n){var d={isWeighted:!1,init:function(){d.$components=i('[data-fieldhelpers-field-repeater="ld_gb_components"]'),d.$components.length&&(d.initGradebookWeightingInterface(),d.initGradebookComponents(),d.initUserSelect())},initGradebookWeightingInterface:function(){d.$interface=i("#ld-gb-gradebook-weighting"),d.$interface.length&&(d.weightingUpdateComponentList(),i('[data-fieldhelpers-name="ld_gb_gradebook_weighting_enable"] [data-fieldhelpers-field-toggle]').change(d.toggleInterfaceVisibility),i(document).on("keyup",'[name^="ld_gb_components"][name$="[name]"]',d.weightingUpdateComponentList),d.$components.on("repeater-add-item",d.weightingUpdateComponentList),d.$components.on("repeater-delete-item",d.weightingUpdateComponentList),d.$components.find(".fieldhelpers-field-repeater-list").on("list-update",d.weightingUpdateComponentList),i("form#post").submit(d.validateComponentWeights))},toggleInterfaceVisibility:function(e,t){"1"===t?(d.isWeighted=!0,d.$interface.show()):(d.isWeighted=!1,d.$interface.hide(),d.setInterfaceError(100))},validateComponentWeights:function(e){if(d.isWeighted){var t=0;d.$interface.find(".ld-gb-gradebook-weighting-component").each(function(){var e=parseInt(i(this).find('[name^="ld_gb_components"][name$="[weight]"]').val());t=e+t}),100!==t&&e.preventDefault(),d.setInterfaceError(t)}},setInterfaceError:function(e){var t=d.$interface.closest(".postbox"),n=t.find(".ld-gb-component-weighting-error-message");100!==e?(t.addClass("ld-gb-component-weighting-error"),n.show().find(".current-weight").html(e)):(t.removeClass("ld-gb-component-weighting-error"),n.hide())},weightingUpdateComponentList:function(){var e=d.weightingGetComponents(),a={};e.map(function(e,t){var n=d.$interface.find('.ld-gb-gradebook-weighting-component[data-id="'+e.id+'"]');n.length&&(a[e.id]=n.find('input[name$="[weight]"]').val())}),d.$interface.find("tbody").html(""),e.map(function(e,t){var n=a[e.id]||0,o=i('<tr class="ld-gb-gradebook-weighting-component" data-id="'+e.id+'"><td class="ld-gb-gradebook-weighting-component-name">'+e.name+'</td><td class="ld-gb-gradebook-weighting-component-weight"><input type="number" min="0" max="100" value="'+n+'" name="ld_gb_components['+t+'][weight]" /></td></tr>');o.show(),d.$interface.find("tbody").append(o)})},weightingGetComponents:function(){var e=d.$components.find("[data-repeater-item]"),t=[];return e.each(function(){var e={name:i(this).find('input[name$="[name]"]').val()||n.component_no_name,id:i(this).find('input[name$="[id]"]').val()};t.push(e)}),t},initGradebookComponents:function(){d.$components.find("[data-fieldhelpers-field-toggle]").on("change",d.toggleGradebookComponentsSelect),d.$components.on("repeater-add-item",function(e,t){d.componentLoading(!0,t),t.find("[data-fieldhelpers-field-toggle]").on("change",d.toggleGradebookComponentsSelect),d.toggleLessonsTopics(d.$course.val()),d.setComponentsError(!1),d.setComponentID(t)}),d.$course=i('select[name="ld_gb_course"]'),d.$course.length&&(d.$course.change(function(){d.componentsLoading(!0),d.setCourseOptions(i(this).val()),d.toggleLessonsTopics(i(this).val())}),d.$course.trigger("change")),i("form#post").submit(d.validateComponents)},componentLoading:function(e,t){e?t.append(i('<div class="ld-gb-loading-overlay"><span class="spinner is-active"></span></div>')):t.find(".ld-gb-loading-overlay").remove()},validateComponents:function(e){d.$components.find("[data-repeater-item]").length?d.setComponentsError(!1):(e.preventDefault(),d.setComponentsError(!0))},setComponentsError:function(e){var t=d.$components.closest(".postbox"),n=t.find(".ld-gb-component-error-message");e?(t.addClass("ld-gb-component-error"),n.show()):(t.removeClass("ld-gb-component-error"),n.hide())},setComponentID:function(t){i.ajax({method:"POST",url:ajaxurl,data:{action:"ld_gb_get_new_component_id",gradebook_id:LD_GB_Admin.gradebook_id}}).done(function(e){e.success&&(t.find('[data-fieldhelpers-name="id"] input[type="hidden"]').val(e.data.id),d.componentLoading(!1,t))})},componentsLoading:function(e){e?d.$components.append('<div class="ld-gb-loading-overlay"><span class="spinner is-active"></span></div>'):d.$components.find(".ld-gb-loading-overlay").remove()},setCourseOptions:function(e){i.ajax({method:"POST",url:ajaxurl,data:{action:"ld_gb_get_component_options",course:e,postID:i("#post_ID").val(),postStatus:i("#original_post_status").val()}}).done(function(t){i("select.ld-gb-component-items-select").each(function(){var n=i(this),o=[],e=i(this).attr("data-type");n.find("option:selected").each(function(){o.push(parseInt(i(this).val()))}),n.html(""),t.data[e].map(function(e){var t=-1!==o.indexOf(e.value);n.append(i('<option value="'+e.value+'" '+(t&&"selected")+">"+e.text+"</option>"))})}),d.componentsLoading(!1)})},toggleLessonsTopics:function(e){var t=i('[data-fieldhelpers-name="lessons_section_divider"],[data-fieldhelpers-name="lessons"],[data-fieldhelpers-name="lessons_all"],[data-fieldhelpers-name="lessons_clearfix"],[data-fieldhelpers-name="topics_section_divider"],[data-fieldhelpers-name="topics"],[data-fieldhelpers-name="topics_all"],[data-fieldhelpers-name="topics_clearfix"]');e?t.show():t.hide()},toggleGradebookComponentsSelect:function(e,t){i(this).closest(".fieldhelpers-field-toggle").attr("data-fieldhelpers-name");var n=i(this).find(".fieldhelpers-field-input").attr("data-disable-group"),o=i(this).closest(".fieldhelpers-field-repeater-content").find('[data-disable-from-all="'+n+'"]');"1"===t?o.prop("disabled",!0):o.prop("disabled",!1)},initUserSelect:function(){if(d.$userSelect=i("#user_view_grades"),d.$userSelect.length){var e=d.$userSelect.closest(".fieldhelpers-field-select").next("[data-open-user-grades]"),t=e.attr("href");d.$userSelect.rbmfhselect2({containerCssClass:"fieldhelpers-select2",dropdownCssClass:"fieldhelpers-select2",placeholder:n.select_a_user,minimumInputLength:3,ajax:{delay:500,url:"/wp-json/wp/v2/users/",data:function(e){return{search:e.term,per_page:10,page:e.page||1,has_published_posts:!1}},processResults:function(e){for(var t=[],n=0;n<e.results.length;n++)t.push({id:e.results[n].id,text:e.results[n].name});return{results:t,pagination:e.pagination}},transport:function(a,e,t){var n=i.ajax(a);n.then(function(e,t,n){var o=parseInt(n.getResponseHeader("X-WP-TotalPages"))||0;return{results:e,pagination:{more:a.data.page<o}}}).then(e),n.fail(t)}}}),d.$userSelect.change(function(){e.removeClass("disabled"),e.attr("href",t+"&user="+i(this).val())}),e.click(function(e){i(this).hasClass("disabled")&&e.preventDefault()})}}};i(d.init)}(jQuery,LD_GB_Admin.l10n),function(t){"use strict";var e={init:function(){e.notices(),e.shift_key_utility()},notices:function(){t(".ld-gb-notice.is-dismissible").each(function(){t(this).hasClass("not-dismissable")?t(this).removeClass("is-dismissible"):t(this).find(".notice-dismiss").click(e.dismiss_notice)})},dismiss_notice:function(){var e=t(this).closest(".ld-gb-notice").attr("id");t.post(ajaxurl,{action:"ld_gb_dismiss_notice",id:e})},shift_key_utility:function(){window.ld_gb_shift_key_down=!1,t(document).on("keydown",function(e){16===e.which&&(window.ld_gb_shift_key_down=!0)}),t(document).on("keyup",function(e){16===e.which&&(window.ld_gb_shift_key_down=!1)})}};t(e.init)}(jQuery,LD_GB_Admin.l10n),function(e,t){"use strict";e(function(){e("body").hasClass("ld-gb-quickstart")&&(e("body").is(".post-php, .post-type-gradebook")&&(e("form#post").submit(function(e){e.preventDefault()}),e('[data-fieldhelpers-name="ld_gb_components"]').find("[data-repeater-delete], [data-repeater-create]").prop("disabled",!0)),e("body").hasClass("admin_page_learndash-gradebook-user-grades")&&(e(".ld-gb-return-button").remove(),e("[data-edit-grade], [data-ld-gb-component-grade], [data-add-manual-grade]").click(function(e){return e.preventDefault(),alert(t.disabled_for_quickstart),!1})))})}(jQuery,LD_GB_Admin.l10n),function(l,c){"use strict";var t,n=[];function o(e){var t,n,o=l(e.target);l(e.target).pointer(e.options).pointer("open"),t=o.pointer("widget"),o.pointer("reposition"),n=t.hasClass("wp-pointer-top")?t.offset().top-t.height():t.offset().top,o.closest("#adminmenu").length?(t.css("position","fixed"),t.position().top+t.height()>l(window).height()&&t.css("top",l(window).height()-t.height()),t.position().top<0&&t.css("top",0)):l("body, html").animate({scrollTop:n-l("#wpadminbar").height()},500)}function a(e){var t=l(e.target).pointer("widget");t.is(":visible")&&t.fadeOut(300)}function g(e){n.length<=1||void 0!==n[++t]&&(a(n[t-1]),o(n[t]),e.preventDefault())}function p(e){n.length<=1||void 0!==n[--t]&&(a(n[t+1]),o(n[t]),e.preventDefault())}l(function(){"undefined"!=typeof LD_GB_Quickstart&&LD_GB_Quickstart&&(l.each(LD_GB_Quickstart,function(e,s){l.extend(s.options,{pointerClass:"wp-pointer ld-gb-pointer",pointerWidth:450,close:function(){l.post(ajaxurl,{action:"ld_gb_disable_quickstart"},function(e){if(void 0!==e.success&&e.success){var t,n=window.location.href,o=["ld_gb_quickstart","gradebook","post"];for(var a in o){t=o[a];var i=n.split("?");if(2<=i.length){for(var d=encodeURIComponent(t)+"=",r=i[1].split(/[&;]/g),s=r.length;0<s--;)-1!==r[s].lastIndexOf(d,0)&&r.splice(s,1);n=i[0]+(0<r.length?"?"+r.join("&"):"")}}window.location=n}else void 0!==e.data&&void 0!==e.data.error?alert(e.data.error):alert(c.disable_quickstart_error_generic)})},buttons:function(e,t){var n=wpPointerL10n?wpPointerL10n.dismiss:"Dismiss",o=s.options.quickstart_text?s.options.quickstart_text:c.quickstart_text,a=!!s.options.quickstart_link&&s.options.quickstart_link,i=s.options.quickstart_back_text?s.options.quickstart_back_text:c.quickstart_back_text,d=!!s.options.quickstart_back_link&&s.options.quickstart_back_link,r=l('<div class="ld-gb-quickstart-buttons">'+('<a class="close" href="#">'+n+"</a>")+('<a class="button quickstart" href="'+a+'">'+o+"</a>")+('<a class="quickstart-back" href="'+d+'">'+i+"</a>")+"</div>");return!1===a&&r.find(".quickstart").remove(),!1===d&&r.find(".quickstart-back").remove(),r.on("click",".quickstart",g),r.on("click",".quickstart-back",p),r.on("click",".close",function(e){e.preventDefault(),t.element.pointer("close")})}});n.push(s)}),n.length&&l(window).load(function(){o(n[t=0])}))})}(jQuery,LD_GB_Admin.l10n),function(a,e){e={$elements:{},init:function(){e.get_elements(),e.$elements.repeaters.length&&(e.setup_repeaters_data(),e.init_repeaters(),a(document).on("click","a[data-repeater-delete], a[data-repeater-create]",function(e){e.preventDefault()}))},get_elements:function(){e.$elements.repeaters=a("[data-ld-gb-repeater]")},setup_repeaters_data:function(){},init_repeaters:function(){e.$elements.repeaters.each(e.init_repeater)},init_repeater:function(){var e=!!a(this).attr("data-first-item-undeletable"),t=!!a(this).attr("data-init-empty"),n=a(this),o=a(this).attr("data-default-values")||{};a(this).repeater({hide:function(e){a(this).hasClass("locked")||confirm(LD_GB_Admin.l10n.repeater_confirm_delete)&&(n.trigger("repeater-remove",[a(this)]),e(),n.trigger("repeater-removed"))},show:function(){n.trigger("repeater-add",[a(this)]),a(this).show(),n.trigger("repeater-added",[a(this)])},isFirstItemUndeletable:e,defaultValues:o,initEmpty:t}),a(this).find("[data-repeater-item-dummy]").remove(),a(this).trigger("repeater-init")}},a(e.init)}(jQuery,LD_GB_jQuery_Repeaters),function(o){var a,i;function e(e){var t=o(this).val(),n=d(a);o(this).prop("checked")&&-1===n.indexOf(t)&&a.filter(function(e){return o(this).val()==t}).attr("checked",!0).trigger("change")}function t(e){var t=o(this).val(),n=d(i);o(this).prop("checked")||-1<n.indexOf(t)&&i.filter(function(e){return o(this).val()==t}).attr("checked",!1).trigger("change")}function d(e){var n=[];return e.each(function(e,t){o(t).prop("checked")&&n.push(o(t).val())}),n}o(function(){a=o('input[name="ld_gb_gradebook_roles[]"]'),i=o('input[name="ld_gb_edit_gradebook_roles[]"]'),a.length&&i.length&&(i.on("change",e),a.on("change",t))})}(jQuery),function(d,r){"use strict";var e,t,s,n;function o(e,t){s.removeClass("no-components"),t.find('[name$="term_id]"]').val(""),t.find(".ld-gb-edit-components-info").html(""),t.removeClass("locked"),t.find('[name$="[name]"]').focus()}function a(e){s.find("[data-repeater-item]").length||s.addClass("no-components")}function i(e){e.preventDefault(),l(r.cannot_delete_component)}function l(e){window.clearTimeout(n),t.find("p").html(e),t.stop().slideDown(300)}function c(){return t.stop().slideUp(300,function(){d(this).find("p").html("")}),!1}function g(e){var t=s.find('[name$="weight]"]:visible,[name$="name]"]:visible');t.length?t.each(function(){if(!d(this).val())return e.preventDefault(),l(r.required),!1}):c()}function p(e){var t,n,o=s.find('[name*="weight"]:visible'),a=0,i=!1;if(o.length){for(t=0;t<o.length;t++){if(!(n=d(o.get(t))).val())return;if(100<(a+=parseInt(n.val()))){e.preventDefault(),i=r.weights_too_high.replace("{percent}",a);break}if(t+1===o.length&&a<100){e.preventDefault(),i=r.weights_too_low.replace("{percent}",a);break}}i?l(i):c()}}d(function(){(s=d("#ld-gb-edit-components")).length&&(e=d("#ld-gb-edit-components-form"),t=s.find(".notice.error"),s.on("repeater-added",o),s.on("repeater-removed",a),s.on("click",".locked [data-repeater-delete]",i),s.on("click",".notice-dismiss",c),e.submit(p),e.submit(g))})}(jQuery,LD_GB_Admin.l10n),function(l,c){"use strict";var g={$elements:{},init:function(){g.get_elements(),g.$elements&&g.setup_handlers()},get_elements:function(){g.$elements.gradebook=l("#ld-gb-gradebook")},setup_handlers:function(){g.$elements.gradebook.on("click","[data-ld-gb-component-edit]",g.edit_component_grade),g.$elements.gradebook.on("click","[data-ld-gb-component-cancel]",g.cancel_component_grade),g.$elements.gradebook.on("click","[data-ld-gb-component-submit]",g.submit_component_grade),g.$elements.gradebook.on("click","[data-ld-gb-component-delete]",g.delete_component_grade),g.$elements.gradebook.on("keypress",".ld-gb-gradebook-component-edit input",g.submit_component_grade),g.$elements.gradebook.on("click","[data-edit-grade]",g.edit_grade),g.$elements.gradebook.on("click","[data-cancel-edit-grade]",g.cancel_edit_grade),g.$elements.gradebook.on("click","[data-submit-edit-grade]",g.submit_edit_grade),g.$elements.gradebook.on("click","[data-remove-manual-grade]",g.remove_manual_grade),g.$elements.gradebook.on("click","[data-add-manual-grade]",g.add_manual_grade),g.$elements.gradebook.on("click","[data-cancel-add-manual-grade]",g.cancel_edit_manual_grade),g.$elements.gradebook.on("keypress",".ld-gb-gradebook-component-grade-editform input,.ld-gb-gradebook-component-grade-editform select,.ld-gb-gradebook-component-grade-editform textarea",g.submit_edit_grade)},edit_component_grade:function(e){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component-overall-grade"),n=t.attr("data-ld-gb-component-grade");t.find('input[type="text"][name="ld-gb-component-override"]').val(n),t.addClass("editing")},cancel_component_grade:function(e){e.preventDefault(),g.close_edit_component_grade(l(this).closest(".ld-gb-gradebook-component-overall-grade"))},delete_component_grade:function(e){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component-overall-grade"),n=t.closest(".ld-gb-gradebook-component"),o=t.attr("data-user-id"),a=t.attr("data-component-id");t.find(".ld-gb-gradebook-component-edit").append('<div class="ld-gb-gradebook-component-overall-grade-cover"><span class="spinner"></span></div>'),t.find("input, button, textarea, select").prop("disabled",!0),l.post(ajaxurl,{action:"ld_gb_edit_component_grade",data:{action:"delete",user_id:o,component_id:a,gradebook:LD_GB_Admin.gradebook}},function(e){void 0!==e.success&&(e.success&&(t.attr("data-ld-gb-component-grade",e.data.component_grade.grade),g.change_user_grade(e.data.user_grade),g.change_component_grade(n,e.data.component_grade),t.removeClass("overridden"),t.find("[data-ld-gb-component-edit]").html(c.component_grade_override),n.find(".ld-gb-gradebook-component-overridden-notice").hide()),g.close_edit_component_grade(t))})},submit_component_grade:function(e){if(void 0===e.which||13==e.which||1==e.which){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component-overall-grade"),n=t.closest(".ld-gb-gradebook-component"),o=t.attr("data-user-id"),a=t.attr("data-component-id"),i=t.find('input[type="text"][name="ld-gb-component-override"]').val();t.find(".ld-gb-gradebook-component-edit").append('<div class="ld-gb-gradebook-component-overall-grade-cover"><span class="spinner"></span></div>'),t.find("input, button, textarea, select").prop("disabled",!0),l.post(ajaxurl,{action:"ld_gb_edit_component_grade",data:{action:"save",new_grade:i,user_id:o,component_id:a,gradebook:LD_GB_Admin.gradebook}},function(e){void 0!==e.success&&(e.success&&(t.attr("data-ld-gb-component-grade",e.data.component_grade.grade),g.change_user_grade(e.data.user_grade),g.change_component_grade(n,e.data.component_grade),t.addClass("overridden"),t.find("[data-ld-gb-component-edit]").html(c.component_grade_modify),n.find(".ld-gb-gradebook-component-overridden-notice").show()),g.close_edit_component_grade(t))})}},close_edit_component_grade:function(e){e.find(".ld-gb-gradebook-component-overall-grade-cover").remove(),e.find("input, button, textarea, select").prop("disabled",!1),e.removeClass("editing")},edit_grade:function(e){e.preventDefault();var t=l(this).closest("tr"),n=t.next("tr.ld-gb-gradebook-component-grade-editform");t.length&&n.length&&(t.addClass("editing"),n.addClass("editing"))},cancel_edit_grade:function(e){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component"),n=l(this).closest("tr"),o=n.prev("tr.ld-gb-gradebook-component-grade-display"),a=t.find("[data-add-manual-grade]");"undefined"!=o.attr("data-template")&&o.length&&n.length&&(o.removeClass("editing"),n.removeClass("editing"),a.show())},submit_edit_grade:function(e){if(void 0===e.which||13==e.which||1==e.which){e.preventDefault();var t,n=l(this).closest(".ld-gb-gradebook-component"),o=l(this).closest("tr.ld-gb-gradebook-component-grade-editform"),a=o.prev("tr.ld-gb-gradebook-component-grade-display"),i=o.find("input, select, textarea"),d=o.find(".ld-gb-gradebook-component-grade-message"),r=n.find("[data-no-grades]"),s={};if(i.each(function(){s[l(this).attr("name").replace("grade-","")]=l(this).val()}),void 0!==s.type){if("manual"==(t=s.type)){if(void 0===s.name||void 0===s.score||!s.score)return void g.show_message(d,c.manual_grade_add_error,"error");g.hide_message(d,"error")}l.post(ajaxurl,{action:"ld_gb_edit_grade",data:s},function(e){"0"!=e?e.success?(g.show_message(d,e.data.success,"success"),"manual"==t&&(a.find(".ld-gb-gradebook-component-grade-name-content").html(e.data.name),o.find('[name="grade-previous_name"]').val(e.data.name),o.find('[name="grade-score"]').val(e.data.score),o.find('[name="grade-new"]').val("1")&&(o.find('[name="grade-new"]').val("0"),o.find("[data-submit-edit-grade]").html(c.change),o.find("[data-cancel-add-manual-grade]").removeAttr("data-cancel-add-manual-grade").attr("data-cancel-edit-grade","1").html(c.close))),void 0!==e.data.score_display&&a.find(".ld-gb-gradebook-component-grade-score-content").html(e.data.score_display),void 0!==e.data.user_grade&&g.change_user_grade(e.data.user_grade),void 0!==e.data.component_grade&&g.change_component_grade(n,e.data.component_grade),n.find("tbody tr:not([data-template])").length?r.hide():r.show()):g.show_message(d,e.data.error,"error"):g.show_message(d,c.could_not_edit_grade,"error")})}}},add_manual_grade:function(e){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component"),n=t.find("tr.ld-gb-gradebook-component-grade-display[data-template]"),o=t.find("tr.ld-gb-gradebook-component-grade-editform[data-template]"),a=n.clone(),i=o.clone();i.find(':input:not([type="hidden"])').each(function(e,t){var n=l(t).data("default");void 0===n&&(n=""),l(t).val(n)}),i.insertBefore(n).addClass("editing").removeAttr("data-template"),a.insertBefore(i).addClass("editing").removeAttr("data-template"),l(this).hide()},cancel_edit_manual_grade:function(e){e.preventDefault();var t=l(this).closest(".ld-gb-gradebook-component"),n=l(this).closest("tr"),o=n.prev("tr.ld-gb-gradebook-component-grade-display"),a=t.find("[data-add-manual-grade]");o.length&&n.length&&(o.remove(),n.remove(),a.show())},remove_manual_grade:function(e){if(e.preventDefault(),confirm(c.manual_grade_confirm_delete)){var t=l(this).closest(".ld-gb-gradebook-component"),n=l(this).closest("tr.ld-gb-gradebook-component-grade-display"),o=n.next("tr.ld-gb-gradebook-component-grade-editform"),a=o.find("input, select, textarea"),i=t.find("[data-no-grades]"),d={};a.each(function(){d[l(this).attr("name").replace("grade-","")]=l(this).val()}),d.delete="1",l.post(ajaxurl,{action:"ld_gb_edit_grade",data:d},function(e){"0"!=e&&e.success&&(n.addClass("deleted").fadeOut(500,function(){n.remove(),o.remove(),t.find("tbody tr:not([data-template]):not([data-no-grades])").length?i.hide():i.show()}),void 0!==e.data.user_grade&&g.change_user_grade(e.data.user_grade),void 0!==e.data.component_grade&&g.change_component_grade(t,e.data.component_grade))})}},get_manual_edit_elements:function(e){var t={};return t.name=e.find(".ld-gb-gradebook-component-grade-name"),t.name_content=t.name.find(".ld-gb-gradebook-component-grade-name-content"),t.score=e.find(".ld-gb-gradebook-component-grade-score"),t.score_content=t.score.find(".ld-gb-gradebook-component-grade-score-content"),t.input_name=t.name.find('input[name="ld_gb_gradebook_component_grade_name"]'),t.input_score=t.score.find('input[name="ld_gb_gradebook_component_grade_score"]'),t},change_user_grade:function(e){g.$elements.gradebook.find("span.user-grade").html(e.score).css("background",e.color)},change_component_grade:function(e,t){e.find(".ld-gb-gradebook-component-overall-grade .ld-gb-grade").html(t.score).css("background",t.color)},show_message:function(e,t,n){e.find(".notice-"+n).stop().slideDown(150).find("p").html(t),e.find(".notice-"+n).delay(5e3).slideUp(150)},hide_message:function(e,t){e.find(".notice-"+t).stop().slideUp(150)},row_set_processing:function(e){e.addClass("processing"),e.find(".ld-gb-gradebook-component-grade-name").append('<span class="spinner"></span>')},row_remove_processing:function(e){e.removeClass("processing"),e.find(".spinner").remove()},stop_propagation:function(e){e.stopPropagation()}};l(g.init)}(jQuery,LD_GB_Admin.l10n);